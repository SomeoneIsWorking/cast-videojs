<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video.js Cast Receiver - Test Sender</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    button {
      background: #ff0046;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background: #e6003d;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .status {
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      background: #f0f0f0;
    }
    .info {
      font-size: 14px;
      color: #666;
      margin-top: 20px;
    }
    .cast-button {
      display: inline-block;
      margin: 10px 0;
    }
  </style>
  <script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¬ Video.js Cast Receiver Test</h1>
    
    <div class="cast-button">
      <google-cast-launcher></google-cast-launcher>
    </div>

    <div class="status" id="status">
      Status: Not connected
    </div>

    <h3>Test Media</h3>
    <input type="text" id="mediaUrl" placeholder="Media URL (HLS or MP4)" 
           value="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8">
    
    <input type="text" id="mediaTitle" placeholder="Title" value="Big Buck Bunny">
    
    <input type="text" id="mediaSubtitle" placeholder="Subtitle" value="Test Stream">
    
    <button onclick="loadMedia()">Cast Media</button>
    <button onclick="playPause()">Play/Pause</button>
    <button onclick="stop()">Stop</button>

    <div class="info">
      <h4>Instructions:</h4>
      <ol>
        <li>Make sure your Chromecast receiver is registered with your Application ID</li>
        <li>Update the APPLICATION_ID in this file</li>
        <li>Click the Cast button to connect to your Chromecast</li>
        <li>Enter a media URL and click "Cast Media"</li>
      </ol>
      
      <h4>Remote Control Features:</h4>
      <ul>
        <li>Press <strong>A</strong> on your TV remote to open audio track menu</li>
        <li>Press <strong>S</strong> for subtitle menu</li>
        <li>Press <strong>Q</strong> for quality menu</li>
        <li>Use arrow keys to navigate, Enter to select</li>
      </ul>
    </div>
  </div>

  <script>
    // TODO: Replace with your actual Chromecast Application ID
    const APPLICATION_ID = 'YOUR_APPLICATION_ID_HERE';
    
    let castSession = null;
    let mediaSession = null;

    window['__onGCastApiAvailable'] = function(isAvailable) {
      if (isAvailable) {
        initializeCastApi();
      }
    };

    function initializeCastApi() {
      const castContext = cast.framework.CastContext.getInstance();
      
      castContext.setOptions({
        receiverApplicationId: APPLICATION_ID,
        autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
      });

      castContext.addEventListener(
        cast.framework.CastContextEventType.SESSION_STATE_CHANGED,
        (event) => {
          switch (event.sessionState) {
            case cast.framework.SessionState.SESSION_STARTED:
              castSession = castContext.getCurrentSession();
              updateStatus('Connected to ' + castSession.getCastDevice().friendlyName);
              break;
            case cast.framework.SessionState.SESSION_ENDED:
              castSession = null;
              mediaSession = null;
              updateStatus('Disconnected');
              break;
          }
        }
      );

      updateStatus('Cast API initialized. Click the Cast button to connect.');
    }

    function loadMedia() {
      if (!castSession) {
        alert('Please connect to a Chromecast device first');
        return;
      }

      const mediaUrl = document.getElementById('mediaUrl').value;
      const title = document.getElementById('mediaTitle').value;
      const subtitle = document.getElementById('mediaSubtitle').value;

      const mediaInfo = new chrome.cast.media.MediaInfo(mediaUrl, 'application/x-mpegURL');
      
      mediaInfo.metadata = new chrome.cast.media.GenericMediaMetadata();
      mediaInfo.metadata.title = title;
      mediaInfo.metadata.subtitle = subtitle;

      const request = new chrome.cast.media.LoadRequest(mediaInfo);
      
      castSession.loadMedia(request).then(
        () => {
          mediaSession = castSession.getMediaSession();
          updateStatus('Media loaded: ' + title);
        },
        (error) => {
          updateStatus('Error loading media: ' + error);
        }
      );
    }

    function playPause() {
      if (!mediaSession) {
        alert('No media is currently playing');
        return;
      }

      if (mediaSession.playerState === chrome.cast.media.PlayerState.PLAYING) {
        mediaSession.pause(new chrome.cast.media.PauseRequest());
        updateStatus('Paused');
      } else {
        mediaSession.play(new chrome.cast.media.PlayRequest());
        updateStatus('Playing');
      }
    }

    function stop() {
      if (!mediaSession) {
        alert('No media is currently playing');
        return;
      }

      mediaSession.stop(new chrome.cast.media.StopRequest());
      updateStatus('Stopped');
    }

    function updateStatus(message) {
      document.getElementById('status').textContent = 'Status: ' + message;
    }
  </script>
</body>
</html>
